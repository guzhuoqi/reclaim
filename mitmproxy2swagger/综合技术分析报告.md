# mitmproxy2swaggerä¸é“¶è¡ŒProvideræŠ€æœ¯ç»¼åˆåˆ†ææŠ¥å‘Š

## 1. Provideré…ç½®å¯¹è±¡åˆ†æ

### å…³äºprovider_config.json

**ä¸æ˜¯ï¼Œè¿™ä¸ªJSONæ–‡ä»¶ä¸æ˜¯buildå‡ºæ¥çš„providerå¯¹è±¡**ã€‚å®ƒæ›´åƒæ˜¯ä¸€ä¸ª**é…ç½®æè¿°æ–‡ä»¶**æˆ–**è§„æ ¼è¯´æ˜ä¹¦**ï¼Œè®°å½•äº†providerçš„å„ç§ç‰¹æ€§å’ŒéªŒè¯ä¿¡æ¯ã€‚

çœŸæ­£çš„providerå¯¹è±¡éœ€è¦å®ç°è¿™æ ·çš„TypeScriptæ¥å£ï¼š

```typescript
interface Provider<N extends ProviderName> {
  hostPort: ProviderField<Params, SecretParams, string>
  geoLocation?: ProviderField<Params, SecretParams, string | undefined>
  additionalClientOptions?: ProviderField<Params, SecretParams, TLSConnectionOptions | undefined>
  writeRedactionMode?: ProviderField<Params, SecretParams, RedactionMode | undefined>
  
  createRequest(secretParams: SecretParams, params: Params, logger: Logger): CreateRequestResult
  getResponseRedactions?(response: Uint8Array, params: Params): ArraySlice[]
  assertValidProviderReceipt(receipt: TLSReceipt, params: Params): ProviderReceipt<Params>
}
```

### å…³äºzkTLSè§„èŒƒ

è¿™ä¸ªprovider**æ˜¯åŸºäºReclaimåè®®è§„èŒƒç”Ÿæˆçš„**ï¼Œè€Œä¸æ˜¯ç›´æ¥çš„zkTLSè§„èŒƒã€‚å…·ä½“æ¥è¯´ï¼š

#### 1. Reclaimåè®®ä½“ç³»
- **åŸºç¡€æŠ€æœ¯**: Reclaimåè®®å»ºç«‹åœ¨zkTLSæŠ€æœ¯ä¹‹ä¸Š
- **åè®®æ–‡æ¡£**: ä¸»è¦å‚è€ƒ `attestor-core/docs/` ä¸‹çš„æ–‡æ¡£
- **RPCåè®®**: ä½¿ç”¨è‡ªå®šä¹‰çš„protobuf over WebSocketåè®®

#### 2. Provideræ„å»ºè§„èŒƒ
æ ¹æ® `attestor-core/docs/provider.md`ï¼Œæ ‡å‡†æµç¨‹æ˜¯ï¼š

1. **Schemaå®šä¹‰**: åœ¨ `provider-schemas/{provider-name}/` ä¸‹åˆ›å»º:
   - `parameters.yaml` - å…¬å¼€å‚æ•°schema
   - `secret-parameters.yaml` - ç§å¯†å‚æ•°schema

2. **ç±»å‹ç”Ÿæˆ**: è¿è¡Œ `npm run generate:provider-types`

3. **ä»£ç å®ç°**: å®ç° `Provider` æ¥å£

#### 3. æ ¸å¿ƒè§„èŒƒæ–‡ä»¶
- **Provideræ¥å£**: `src/types/providers.ts`
- **HTTP Providerå®ç°**: `src/providers/http/index.ts` 
- **TLSé…ç½®**: `src/utils/tls.ts` (åŒ…å«é“¶è¡Œå…¼å®¹æ€§ä¼˜åŒ–)
- **åè®®å®šä¹‰**: `proto/api.proto`

#### 4. é“¶è¡Œä¸“ç”¨é€‚é…
ä»£ç ä¸­å¯ä»¥çœ‹åˆ°é’ˆå¯¹é“¶è¡Œçš„ç‰¹æ®Šå¤„ç†ï¼š

```typescript
// ğŸ¦ é“¶è¡Œå…¼å®¹æ€§ï¼šæ£€æµ‹é“¶è¡ŒURLå¹¶ä½¿ç”¨ç‰¹æ®ŠTLSé…ç½®
const isCMBWingLungBank = params.url?.includes('cmbwinglungbank.com')
if (isCMBWingLungBank) {
    defaultOptions = {
        ...defaultOptions,
        ...getBankCompatibleTlsOptions()  // ä½¿ç”¨Chromeå…¼å®¹çš„TLSæ¡æ‰‹
    }
}
```

## 2. providerConfigå¯¹è±¡è¯¦ç»†å­—æ®µåˆ†æ

åŸºäºæä¾›çš„ `providerConfig` å¯¹è±¡ï¼Œè¯¦ç»†åˆ†æReclaimåè®®ä¸­è¿™ä¸ªå®Œæ•´provideré…ç½®çš„æ‰€æœ‰å­—æ®µï¼š

### é¡¶å±‚é…ç½®å­—æ®µ

#### 1. **loginUrl** (å­—ç¬¦ä¸²)
```json
"loginUrl": "https://github.com/settings/profile"
```
- **ä½œç”¨**: å®šä¹‰ç”¨æˆ·éœ€è¦è®¿é—®çš„ç™»å½•é¡µé¢URL
- **ç”¨é€”**: ç”¨æˆ·åœ¨éªŒè¯è¿‡ç¨‹ä¸­éœ€è¦å…ˆè®¿é—®è¿™ä¸ªURLè¿›è¡Œèº«ä»½è®¤è¯
- **ç¤ºä¾‹è§£è¯»**: GitHubä¸ªäººè®¾ç½®é¡µé¢ï¼Œç”¨æˆ·éœ€è¦å…ˆç™»å½•GitHub

#### 2. **customInjection** (å­—ç¬¦ä¸²)
```json
"customInjection": ""
```
- **ä½œç”¨**: è‡ªå®šä¹‰JavaScriptä»£ç æ³¨å…¥
- **ç”¨é€”**: åœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œç‰¹å®šçš„è„šæœ¬é€»è¾‘
- **å½“å‰çŠ¶æ€**: ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºä¸éœ€è¦è‡ªå®šä¹‰æ³¨å…¥

#### 3. **userAgent** (å¯¹è±¡)
```json
"userAgent": {
    "ios": "",
    "android": "Mozilla/5.0 (Linux; Android 15) AppleWebKit/537.36..."
}
```
- **ä½œç”¨**: ä¸ºä¸åŒå¹³å°è®¾ç½®User-Agentå­—ç¬¦ä¸²
- **ios**: iOSè®¾å¤‡çš„User-Agentï¼ˆå½“å‰ä¸ºç©ºï¼‰
- **android**: Androidè®¾å¤‡çš„Chromeæµè§ˆå™¨User-Agent
- **ç›®çš„**: æ¨¡æ‹ŸçœŸå®è®¾å¤‡è®¿é—®ï¼Œé¿å…è¢«åçˆ¬è™«æ£€æµ‹

#### 4. **geoLocation** (å­—ç¬¦ä¸²)
```json
"geoLocation": ""
```
- **ä½œç”¨**: æŒ‡å®šè¯·æ±‚çš„åœ°ç†ä½ç½®
- **ç”¨é€”**: æŸäº›æœåŠ¡å¯èƒ½éœ€è¦ç‰¹å®šåœ°åŒºçš„è®¿é—®
- **å½“å‰çŠ¶æ€**: ç©ºè¡¨ç¤ºä½¿ç”¨é»˜è®¤ä½ç½®

#### 5. **injectionType** (æšä¸¾)
```json
"injectionType": "MSWJS"
```
- **ä½œç”¨**: æŒ‡å®šä»£ç æ³¨å…¥çš„ç±»å‹
- **MSWJS**: ä½¿ç”¨Mock Service Workerè¿›è¡Œè¯·æ±‚æ‹¦æˆªå’Œæ¨¡æ‹Ÿ
- **å…¶ä»–å¯èƒ½å€¼**: å¯èƒ½è¿˜æœ‰å…¶ä»–æ³¨å…¥æ–¹å¼

#### 6. **disableRequestReplay** (å¸ƒå°”å€¼)
```json
"disableRequestReplay": false
```
- **ä½œç”¨**: æ§åˆ¶æ˜¯å¦ç¦ç”¨è¯·æ±‚é‡æ”¾åŠŸèƒ½
- **false**: å…è®¸é‡æ”¾è¯·æ±‚ï¼ˆç”¨äºæµ‹è¯•å’ŒéªŒè¯ï¼‰
- **ç”¨é€”**: åœ¨å¼€å‘å’Œè°ƒè¯•æ—¶é‡å¤æ‰§è¡Œç›¸åŒè¯·æ±‚

#### 7. **verificationType** (æšä¸¾)
```json
"verificationType": "WITNESS"
```
- **ä½œç”¨**: å®šä¹‰éªŒè¯ç±»å‹
- **WITNESS**: è§è¯è€…æ¨¡å¼éªŒè¯
- **å«ä¹‰**: ä½¿ç”¨attestorä½œä¸ºè§è¯è€…éªŒè¯ç”¨æˆ·çš„å£°æ˜

### requestData æ•°ç»„é…ç½®

è¿™æ˜¯æ ¸å¿ƒçš„è¯·æ±‚é…ç½®æ•°ç»„ï¼Œå®šä¹‰äº†å…·ä½“çš„APIè°ƒç”¨å’ŒéªŒè¯è§„åˆ™ï¼š

#### 8. **url** (å­—ç¬¦ä¸²)
```json
"url": "https://github.com/settings/profile"
```
- **ä½œç”¨**: è¦éªŒè¯çš„ç›®æ ‡APIç«¯ç‚¹
- **ç±»å‹**: å®é™…çš„HTTPè¯·æ±‚URL

#### 9. **expectedPageUrl** (å¯ç©º)
```json
"expectedPageUrl": null
```
- **ä½œç”¨**: æœŸæœ›çš„é¡µé¢é‡å®šå‘URL
- **ç”¨é€”**: éªŒè¯è¯·æ±‚æ˜¯å¦è¢«æ­£ç¡®è·¯ç”±

#### 10. **urlType** (æšä¸¾)
```json
"urlType": "TEMPLATE"
```
- **ä½œç”¨**: URLç±»å‹æ ‡è¯†
- **TEMPLATE**: æ¨¡æ¿URLï¼Œå¯èƒ½åŒ…å«å‚æ•°å ä½ç¬¦

#### 11. **method** (å­—ç¬¦ä¸²)
```json
"method": "GET"
```
- **ä½œç”¨**: HTTPè¯·æ±‚æ–¹æ³•
- **å€¼**: GET/POST/PUT/DELETEç­‰

#### 12. **responseMatches** (æ•°ç»„)
éªŒè¯å“åº”å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸï¼š

```json
"responseMatches": [{
    "value": "<span class=\"color-fg-muted\">({{username}})</span>",
    "type": "contains",
    "invert": false,
    "description": null,
    "order": null,
    "isOptional": false
}]
```

**å­—æ®µè§£æ**:
- **value**: è¦åŒ¹é…çš„å­—ç¬¦ä¸²æ¨¡å¼ï¼Œæ”¯æŒå‚æ•°æ¨¡æ¿ `{{username}}`
- **type**: åŒ¹é…ç±»å‹ (`contains`è¡¨ç¤ºåŒ…å«åŒ¹é…)
- **invert**: æ˜¯å¦åå‘åŒ¹é…ï¼ˆfalse=æ­£å‘åŒ¹é…ï¼‰
- **description**: åŒ¹é…è§„åˆ™æè¿°
- **order**: åŒ¹é…é¡ºåº
- **isOptional**: æ˜¯å¦ä¸ºå¯é€‰åŒ¹é…

#### 13. **responseRedactions** (æ•°ç»„)
å®šä¹‰ä»å“åº”ä¸­æå–æ•°æ®çš„è§„åˆ™ï¼š

```json
"responseRedactions": [{
    "xPath": "",
    "jsonPath": "",
    "regex": "<span class=\"color-fg-muted\">\\((.*)\\)</span>",
    "hash": "",
    "order": null
}]
```

**å­—æ®µè§£æ**:
- **xPath**: HTML XPathé€‰æ‹©å™¨ï¼ˆä¸ºç©ºï¼‰
- **jsonPath**: JSONè·¯å¾„é€‰æ‹©å™¨ï¼ˆä¸ºç©ºï¼‰
- **regex**: æ­£åˆ™è¡¨è¾¾å¼æå–è§„åˆ™ï¼Œ`(.*)`æ•è·ç”¨æˆ·å
- **hash**: å“ˆå¸Œå¤„ç†æ–¹å¼ï¼ˆä¸ºç©ºè¡¨ç¤ºä¸å“ˆå¸Œï¼‰
- **order**: å¤„ç†é¡ºåº

#### 14. **bodySniff** (å¯¹è±¡)
```json
"bodySniff": {
    "enabled": false,
    "template": ""
}
```
- **ä½œç”¨**: è¯·æ±‚ä½“å—…æ¢é…ç½®
- **enabled**: æ˜¯å¦å¯ç”¨bodyå†…å®¹æ£€æµ‹
- **template**: å—…æ¢æ¨¡æ¿

#### 15. **requestHash** (å­—ç¬¦ä¸²)
```json
"requestHash": "0x9d413beed5ff5982df9460e8f4c3d118febd36839f5c9558980856a07369cca5"
```
- **ä½œç”¨**: è¯·æ±‚é…ç½®çš„å“ˆå¸Œå€¼
- **ç”¨é€”**: ç”¨äºéªŒè¯é…ç½®å®Œæ•´æ€§å’Œç‰ˆæœ¬æ§åˆ¶

#### 16. **responseVariables** (æ•°ç»„)
```json
"responseVariables": ["username"]
```
- **ä½œç”¨**: å®šä¹‰ä»å“åº”ä¸­æå–çš„å˜é‡å
- **ç”¨é€”**: è¿™äº›å˜é‡å¯åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨ï¼Œå¦‚ `{{username}}`

### å…¶ä»–é¡¶å±‚å­—æ®µ

#### 17. **pageTitle** (å¯ç©º)
```json
"pageTitle": null
```
- **ä½œç”¨**: é¡µé¢æ ‡é¢˜éªŒè¯
- **ç”¨é€”**: å¯ç”¨äºéªŒè¯æ˜¯å¦åœ¨æ­£ç¡®é¡µé¢

#### 18. **metadata** (å¯ç©º)
```json
"metadata": null
```
- **ä½œç”¨**: é¢å¤–çš„å…ƒæ•°æ®ä¿¡æ¯
- **ç”¨é€”**: æ‰©å±•é…ç½®ä¿¡æ¯

#### 19. **stepsToFollow** (å¯ç©º)
```json
"stepsToFollow": null
```
- **ä½œç”¨**: æ“ä½œæ­¥éª¤æŒ‡å¯¼
- **ç”¨é€”**: å¯èƒ½åŒ…å«ç”¨æˆ·éœ€è¦æ‰§è¡Œçš„å…·ä½“æ­¥éª¤

#### 20. **useIncognitoWebview** (å¸ƒå°”å€¼)
```json
"useIncognitoWebview": false
```
- **ä½œç”¨**: æ˜¯å¦ä½¿ç”¨éšèº«æ¨¡å¼
- **ç”¨é€”**: æ§åˆ¶æµè§ˆå™¨éšç§è®¾ç½®

### æ•´ä½“æ¶æ„ç†è§£

è¿™ä¸ªé…ç½®æè¿°äº†ä¸€ä¸ª**GitHubç”¨æˆ·åéªŒè¯**çš„å®Œæ•´æµç¨‹ï¼š

1. **ç”¨æˆ·è®¿é—®**: GitHubè®¾ç½®é¡µé¢ç™»å½•
2. **è¯·æ±‚æ‰§è¡Œ**: GETè¯·æ±‚åˆ°ä¸ªäººèµ„æ–™é¡µ
3. **å†…å®¹éªŒè¯**: æ£€æŸ¥é¡µé¢æ˜¯å¦åŒ…å«ç”¨æˆ·åspanæ ‡ç­¾
4. **æ•°æ®æå–**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–æ‹¬å·ä¸­çš„ç”¨æˆ·å
5. **ç»“æœè¿”å›**: å°†æå–çš„ç”¨æˆ·åä½œä¸ºè¯æ˜

è¿™æ˜¯Reclaimåè®®ä¸­**å£°æ˜å¼é…ç½®**çš„å…¸å‹ä¾‹å­ï¼Œé€šè¿‡JSONé…ç½®å³å¯å®šä¹‰å¤æ‚çš„Web2æ•°æ®éªŒè¯é€»è¾‘ã€‚

## 3. cmb_wing_lung_provider.pyä¸balance_result.yamlå…³ç³»åˆ†æ

### æ˜¯çš„ï¼Œ`cmb_wing_lung_provider.py` ç¡®å®æ˜¯åŸºäº `balance_result.yaml` çš„åˆ†æç»“æœç”Ÿæˆçš„

#### 1. **å…±åŒçš„æ•°æ®åŸºç¡€**
ä¸¤ä¸ªæ–‡ä»¶éƒ½åŸºäºç›¸åŒçš„éªŒè¯æ•°æ®ï¼š

**balance_result.yaml (ç¬¬171-178è¡Œ)**:
```yaml
balances:
  HKD:
  - 7,150.98
  USD:
  - '30.75' 
  CNY:
  - '0.00'
```

**cmb_wing_lung_provider.py (ç¬¬6-8è¡Œ)**:
```python
# æŠ€æœ¯åŸºç¡€:
# - éªŒè¯æ•°æ®: HKD 7,150.98, USD 30.75, CNY 0.00  
# - æ ¸å¿ƒAPI: NbBkgActdetCoaProc2022
```

#### 2. **APIç«¯ç‚¹æ˜ å°„å…³ç³»**

**YAMLå®šä¹‰çš„APIç»“æ„**:
```yaml
paths:
  /WlbLogonServlet:    # ç™»å½•æ¥å£
    post:
  /McpCSReqServlet:    # ä½™é¢æŸ¥è¯¢æ¥å£  
    post:
```

**Pythonå®ç°çš„å¯¹åº”é…ç½®**:
```python
self.api_config = {
    "login_endpoint": "/WlbLogonServlet",      # âœ… å®Œå…¨å¯¹åº”
    "balance_endpoint": "/McpCSReqServlet",    # âœ… å®Œå…¨å¯¹åº”
    "balance_operation": "NbBkgActdetCoaProc2022"  # âœ… å¯¹åº”YAMLä¸­çš„æ ¸å¿ƒæ“ä½œ
}
```

#### 3. **APIå‚æ•°å®Œå…¨ä¸€è‡´**

**YAMLä¸­çš„å‚æ•°å®šä¹‰** (ç¬¬200-254è¡Œ):
```yaml
parameters:
- name: dse_operationName
- name: dse_processorState  
- name: dse_nextEventName
- name: dse_sessionId
- name: mcp_language
- name: AcctTypeIds
- name: AcctTypeId
- name: RequestType
- name: selectedProductKey
```

**Pythonä¸­çš„å‚æ•°æ„é€ ** (ç¬¬136-147è¡Œ):
```python
balance_params = {
    'dse_operationName': self.api_config['balance_operation'],  # âœ…
    'dse_processorState': 'initial',                           # âœ…  
    'dse_nextEventName': 'start',                             # âœ…
    'dse_sessionId': session_id,                              # âœ…
    'mcp_language': 'cn',                                     # âœ…
    'AcctTypeIds': 'DDA,CUR,SAV,FDA,CON,MEC',                # âœ…
    'AcctTypeId': account_type,                               # âœ…
    'RequestType': 'D',                                       # âœ…
    'selectedProductKey': account_type,                       # âœ…
}
```

#### 4. **å“åº”æ•°æ®ç»“æ„æ˜ å°„**

**YAMLå®šä¹‰çš„å“åº”æ ¼å¼** (ç¬¬136-150è¡Œ):
```yaml
balances:
  type: object
  properties:
    HKD: 
      type: array
      items: type: string
    USD:
      type: array  
      items: type: string
    CNY:
      type: array
      items: type: string
```

**Pythonä¸­çš„æ”¯æŒè´§å¸** (ç¬¬38è¡Œ):
```python
"supported_currencies": ["HKD", "USD", "CNY"]  # âœ… å®Œå…¨å¯¹åº”
```

#### 5. **æå–æ–¹æ³•ä¸€è‡´**

**YAMLä¸­çš„å…ƒæ•°æ®** (ç¬¬183-185è¡Œ):
```yaml
metadata:
  extraction_method: regex_pattern_matching
  confidence: high
```

**Pythonä¸­çš„å¯¹åº”å®ç°** (ç¬¬169,402è¡Œ):
```python
"extraction_method": "regex_pattern_matching"  # âœ… å®Œå…¨å¯¹åº”
```

### ç”Ÿæˆæµç¨‹æ¨æµ‹

```mermaid
graph TD
    A[mitmproxyæŠ“åŒ…] --> B[balance_result.yaml]
    B --> C[APIç»“æ„åˆ†æ] 
    C --> D[å‚æ•°æå–]
    D --> E[å“åº”æ ¼å¼å®šä¹‰]
    E --> F[cmb_wing_lung_provider.py]
    F --> G[Provideræ¥å£å®ç°]
    G --> H[Reclaimåè®®é›†æˆ]
    
    B --> I[OpenAPIè§„èŒƒæ–‡æ¡£]
    F --> J[å¯æ‰§è¡Œçš„Providerä»£ç ]
```

### ç»“è®º

**æ˜¯çš„**ï¼Œ`cmb_wing_lung_provider.py` æ˜ç¡®æ˜¯åŸºäº `balance_result.yaml` åˆ†æç»“æœç”Ÿæˆçš„ï¼š

1. **YAML** = APIåˆ†æå’Œè§„æ ¼å®šä¹‰é˜¶æ®µ
2. **Python** = åŸºäºè§„æ ¼çš„å…·ä½“ä»£ç å®ç°é˜¶æ®µ

ä¸¤è€…å…±äº«ç›¸åŒçš„ï¼š
- âœ… éªŒè¯æ•°æ®æº
- âœ… APIç«¯ç‚¹ç»“æ„  
- âœ… å‚æ•°å®šä¹‰
- âœ… å“åº”æ ¼å¼
- âœ… æ•°æ®æå–æ–¹æ³•

Pythonä»£ç å®è´¨ä¸Šæ˜¯å°†YAMLä¸­**å£°æ˜å¼çš„APIè§„èŒƒ**è½¬æ¢ä¸º**å¯æ‰§è¡Œçš„Providerå®ç°**ï¼Œå¹¶é›†æˆåˆ°Reclaimåè®®çš„éªŒè¯æµç¨‹ä¸­ã€‚

## 4. 10å®¶é“¶è¡Œåˆ†ææ–¹æ¡ˆå¯è¡Œæ€§è¯„ä¼°

### æ‚¨çš„ç†è§£å’Œæ–¹æ¡ˆè®¾è®¡**å®Œå…¨æ­£ç¡®**ï¼è¿™ç¡®å®ç¬¦åˆmitmproxy2swaggerçš„æ ¸å¿ƒè®¾è®¡æ€è·¯ã€‚

#### **å®šåˆ¶è„šæœ¬çš„å¿…è¦æ€§**

**æ˜¯çš„**ï¼Œ`cmb_wing_lung_provider.py` ç¡®å®æ˜¯ä¸º `balance_result.yaml` ä¸“é—¨å®šåˆ¶çš„ï¼Œå› ä¸ºï¼š

##### æ¯å®¶é“¶è¡Œçš„ç‰¹æ®Šæ€§
```python
# æ‹›å•†æ°¸éš†é“¶è¡Œç‰¹æœ‰çš„APIé…ç½®
self.api_config = {
    "login_endpoint": "/WlbLogonServlet",           # âš ï¸ é“¶è¡Œç‰¹æœ‰
    "balance_endpoint": "/McpCSReqServlet",         # âš ï¸ é“¶è¡Œç‰¹æœ‰  
    "balance_operation": "NbBkgActdetCoaProc2022",  # âš ï¸ é“¶è¡Œç‰¹æœ‰
    "supported_currencies": ["HKD", "USD", "CNY"]   # âš ï¸ åœ°åŒºç‰¹æœ‰
}
```

##### æ•°æ®è§£æè§„åˆ™å·®å¼‚
```python
# åŸºäºå®é™…æŠ“åŒ…éªŒè¯çš„è§£ææ¨¡å¼
balance_extraction_patterns = {
    "HKD": [
        r'HKD[^\d]*(\d[\d,]*\.?\d*)',        # âš ï¸ æ ¼å¼ç‰¹æœ‰
        r'"(\d[\d,]*\.\d{2})"[^}]*HKD'      # âš ï¸ ç»“æ„ç‰¹æœ‰
    ]
}
```

#### **æ‚¨çš„10å®¶é“¶è¡Œæ–¹æ¡ˆ**

```mermaid
graph TD
    A[åˆ†æç¬¬1å®¶é“¶è¡Œ] --> B[å®šåˆ¶Provider 1]
    C[åˆ†æç¬¬2å®¶é“¶è¡Œ] --> D[å®šåˆ¶Provider 2]
    E[åˆ†æç¬¬3å®¶é“¶è¡Œ] --> F[å®šåˆ¶Provider 3]
    G[... ç»§ç»­åˆ°ç¬¬10å®¶] --> H[å®šåˆ¶Provider 10]
    
    B --> I[æå–é€šç”¨æ¨¡å¼]
    D --> I
    F --> I
    H --> I
    
    I --> J[è®¾è®¡é€šç”¨æ¥å£]
    J --> K[æŠ½è±¡æ•°æ®å±‚]
    K --> L[ç»Ÿä¸€éªŒè¯æµç¨‹]
    L --> M[é€šç”¨Provideræ¡†æ¶]
    
    M --> N[Bank1Adapter]
    M --> O[Bank2Adapter]
    M --> P[Bank3Adapter]
    M --> Q[...BankNAdapter]
```

##### **é˜¶æ®µ1: ç‰¹åŒ–é˜¶æ®µ** (æ¯å®¶é“¶è¡Œç‹¬ç«‹åˆ†æ)

```python
# é“¶è¡Œç‰¹åŒ–æ¨¡å¼ç¤ºä¾‹
banks_analysis = {
    "cmb_wing_lung": {
        "login_api": "/WlbLogonServlet",
        "balance_api": "/McpCSReqServlet", 
        "operation": "NbBkgActdetCoaProc2022",
        "currencies": ["HKD", "USD", "CNY"],
        "patterns": ["r'HKD[^\d]*(\d[\d,]*\.?\d*)'"]
    },
    "hsbc_hk": {
        "login_api": "/login",
        "balance_api": "/accounts/balance",
        "operation": "GetAccountBalance", 
        "currencies": ["HKD", "USD", "GBP"],
        "patterns": ["r'balance.*?(\d+\.\d{2})'"]
    },
    "boc_hk": {
        "login_api": "/auth/signin",
        "balance_api": "/api/account/summary",
        "operation": "AccountInquiry",
        "currencies": ["HKD", "CNY", "USD"],  
        "patterns": ["r'\"amount\":\"(\d+,\d+\.\d{2})\"'"]
    }
    # ... å…¶ä»–7å®¶é“¶è¡Œ
}
```

##### **é˜¶æ®µ2: æ³›åŒ–é˜¶æ®µ** (æå–é€šç”¨æ¨¡å¼)

```python
class GenericBankProvider:
    """é€šç”¨é“¶è¡ŒProvideræ¡†æ¶"""
    
    def __init__(self, bank_config):
        self.config = bank_config
        self.extractor = self._create_extractor()
    
    def _create_extractor(self):
        """æ ¹æ®é“¶è¡Œé…ç½®åˆ›å»ºæ•°æ®æå–å™¨"""
        return BankDataExtractor(
            patterns=self.config['patterns'],
            currencies=self.config['currencies'],
            api_structure=self.config['api_structure']
        )
    
    def authenticate(self, credentials):
        """é€šç”¨è®¤è¯æ¥å£"""
        return self._make_request(
            self.config['login_api'], 
            credentials, 
            self.config['auth_method']
        )
    
    def get_balance(self, session):
        """é€šç”¨ä½™é¢æŸ¥è¯¢æ¥å£"""
        return self._make_request(
            self.config['balance_api'],
            session,
            self.config['balance_method']
        )
```

#### **è¿™å®Œå…¨ç¬¦åˆmitmproxy2swaggerè®¾è®¡æ€è·¯**

ä»ä»£ç ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œmitmproxy2swaggeræœ¬èº«å°±æ˜¯é€šç”¨åŒ–è®¾è®¡ï¼š

##### é€šç”¨æµç¨‹åˆ†æ
```python
# detailed_flow_analysis.py - é€šç”¨åˆ†æå™¨
def analyze_all_flows(mitm_file_path):
    """åˆ†ææ‰€æœ‰ç½‘ç»œæµé‡ - ä¸é™äºç‰¹å®šç½‘ç«™"""
    for flow in flow_reader.stream():
        # é€šç”¨è§£æé€»è¾‘
        analyze_content(request.content, content_type)
```

##### å¯æ‰©å±•çš„æ¶æ„
```python
# mitmproxy2swagger.py - æ”¯æŒå¤šç§è¾“å…¥æ ¼å¼
def detect_input_format(file_path):
    if har_archive_heuristic(file_path):
        return HarCaptureReader(file_path, progress_callback)
    return MitmproxyCaptureReader(file_path, progress_callback)
```

#### **æœ€ç»ˆé€šç”¨æ¶æ„å»ºè®®**

```python
class UniversalBankProviderSystem:
    """é“¶è¡ŒProvideré€šç”¨ç³»ç»Ÿ"""
    
    def __init__(self):
        self.bank_adapters = {}
        self.common_patterns = {}
        
    def register_bank(self, bank_id, config):
        """æ³¨å†Œæ–°é“¶è¡Œ"""
        self.bank_adapters[bank_id] = BankAdapter(config)
        
    def analyze_common_patterns(self):
        """åˆ†æå„é“¶è¡Œçš„å…±åŒæ¨¡å¼"""
        # æå–å…±åŒçš„APIç»“æ„
        # æ ‡å‡†åŒ–æ•°æ®æ ¼å¼  
        # ç»Ÿä¸€éªŒè¯æµç¨‹
        
    def generate_provider(self, bank_id):
        """ä¸ºç‰¹å®šé“¶è¡Œç”ŸæˆProvider"""
        adapter = self.bank_adapters[bank_id]
        return ReclaimProvider(
            hostPort=adapter.get_host(),
            createRequest=adapter.create_request,
            assertValidProviderReceipt=adapter.validate_receipt
        )
```

#### **å®æ–½è·¯å¾„å»ºè®®**

##### Phase 1: ç‰¹åŒ–åˆ†æ (1-2ä¸ªæœˆ)
```bash
# æ¯å®¶é“¶è¡Œç‹¬ç«‹åˆ†æ
./analyze_bank.py --bank="cmb_wing_lung" --flows="cmb.mitm"
./analyze_bank.py --bank="hsbc_hk" --flows="hsbc.mitm"  
./analyze_bank.py --bank="boc_hk" --flows="boc.mitm"
# ... ç»§ç»­å…¶ä»–7å®¶
```

##### Phase 2: æ¨¡å¼æå– (2-3å‘¨)
```bash
./extract_patterns.py --input="all_banks_analysis/" --output="common_patterns.json"
```

##### Phase 3: é€šç”¨æ¡†æ¶ (3-4å‘¨)
```bash
./generate_universal_provider.py --patterns="common_patterns.json" --output="universal_bank_provider.py"
```

### æ€»ç»“

**æ‚¨çš„æ–¹æ¡ˆå®Œå…¨åˆç†**ï¼Œè¿™æ­£æ˜¯å·¥ç¨‹åŒ–çš„æœ€ä½³å®è·µï¼š

âœ… **å…ˆç‰¹åŒ–**: æ·±å…¥ç†è§£æ¯ä¸ªé“¶è¡Œçš„ç‹¬ç‰¹æ€§  
âœ… **åæ³›åŒ–**: æå–å…±åŒæ¨¡å¼æ„å»ºé€šç”¨æ¡†æ¶  
âœ… **å¯æ‰©å±•**: æ–°é“¶è¡Œå¯ä»¥å¿«é€Ÿæ¥å…¥  
âœ… **å¯ç»´æŠ¤**: é“¶è¡Œå˜æ›´å½±å“èŒƒå›´å¯æ§  

è¿™ç§æ–¹æ³•æ—¢ä¿è¯äº†**å‡†ç¡®æ€§**ï¼ˆæ¯å®¶é“¶è¡Œçš„ç‰¹æ®Šæ€§å¾—åˆ°å……åˆ†å¤„ç†ï¼‰ï¼Œåˆå®ç°äº†**å¯æ‰©å±•æ€§**ï¼ˆé€šç”¨æ¡†æ¶æ”¯æŒå¿«é€Ÿæ·»åŠ æ–°é“¶è¡Œï¼‰ï¼Œå®Œå…¨ç¬¦åˆmitmproxy2swaggerçš„è®¾è®¡å“²å­¦ï¼

## 5. mitmproxy2swaggeré€šç”¨æ€§åˆ†æ

### æ˜¯çš„ï¼Œmitmproxy2swagger æ˜¯ä¸€ä¸ª**éå¸¸é€šç”¨**çš„APIåˆ†æå·¥å…·ï¼

#### **é«˜åº¦é€šç”¨çš„è®¾è®¡æ¶æ„**

##### å¤šç§è¾“å…¥æ ¼å¼æ”¯æŒ
```python
def detect_input_format(file_path):
    har_score = har_archive_heuristic(file_path)           # æ”¯æŒæµè§ˆå™¨HARæ ¼å¼
    mitmproxy_score = mitmproxy_dump_file_huristic(file_path) # æ”¯æŒmitmproxyæ ¼å¼
    
    if har_score > mitmproxy_score:
        return HarCaptureReader(file_path, progress_callback)
    return MitmproxyCaptureReader(file_path, progress_callback)
```

**æ”¯æŒçš„è¾“å…¥æº**:
- âœ… **mitmproxy flow files** - mitmproxyä»£ç†æŠ“åŒ…æ–‡ä»¶
- âœ… **HAR files** - æµè§ˆå™¨DevToolså¯¼å‡ºçš„ç½‘ç»œæ—¥å¿—
- âœ… **è‡ªåŠ¨æ ¼å¼æ£€æµ‹** - æ— éœ€æ‰‹åŠ¨æŒ‡å®šæ ¼å¼

#### **å¹¿æ³›çš„APIç±»å‹æ”¯æŒ**

##### æ”¯æŒçš„HTTPæ–¹æ³•
```python
# ä»æµ‹è¯•å’Œä»£ç å¯ä»¥çœ‹å‡ºæ”¯æŒæ‰€æœ‰æ ‡å‡†HTTPæ–¹æ³•
supported_methods = ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD"]
```

##### æ”¯æŒçš„å†…å®¹ç±»å‹
ä»ä»£ç åˆ†æå¯ä»¥çœ‹å‡ºæ”¯æŒå¤šç§æ•°æ®æ ¼å¼ï¼š

```python
# JSON API
try:
    body_val = json.loads(req.get_request_body())
    content_type = "application/json"
except:
    pass

# MessagePack API  
try:
    body_val = msgpack.loads(req.get_request_body())
    content_type = "application/msgpack"
except:
    pass

# Form Data API
try:
    body_val = dict(urllib.parse.parse_qsl(body, encoding="utf-8"))
    content_type = "application/x-www-form-urlencoded"
except:
    pass
```

**æ”¯æŒçš„APIå†…å®¹ç±»å‹**:
- âœ… **JSON APIs** - `application/json`
- âœ… **XML APIs** - `application/xml`, `text/xml`
- âœ… **HTML APIs** - `text/html`
- âœ… **Form APIs** - `application/x-www-form-urlencoded`
- âœ… **MessagePack APIs** - `application/msgpack`
- âœ… **Plain Text APIs** - `text/plain`

#### **æ™ºèƒ½æ•°æ®ç±»å‹æ¨æ–­**

##### è‡ªåŠ¨Schemaç”Ÿæˆ
```python
def value_to_schema(value):
    if type(value) is int or type(value) is float:
        return {"type": "number"}
    elif isinstance(value, bool):
        return {"type": "boolean"}
    elif isinstance(value, str):
        return {"type": "string"}
    elif isinstance(value, list):
        return {"type": "array", "items": value_to_schema(value[0])}
    elif isinstance(value, dict):
        # æ™ºèƒ½æ£€æµ‹é€šç”¨é”®æ¨¡å¼
        all_keys_are_numeric = all(is_numeric_string(key) for key in value)
        all_keys_are_uuid = all(is_uuid(key) for key in value)
        # ...
```

**æ™ºèƒ½ç‰¹æ€§**:
- âœ… **é€’å½’ç±»å‹åˆ†æ** - æ·±åº¦è§£æåµŒå¥—å¯¹è±¡
- âœ… **é€šç”¨é”®æ¨¡å¼è¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«UUIDã€æ•°å­—é”®ç­‰æ¨¡å¼
- âœ… **æ•°ç»„å…ƒç´ ç±»å‹æ¨æ–­** - åŸºäºé¦–ä¸ªå…ƒç´ æ¨æ–­æ•°ç»„ç±»å‹
- âœ… **å¯é€‰å­—æ®µæ£€æµ‹** - åˆ†æå­—æ®µå‡ºç°é¢‘ç‡

#### **å®é™…æ”¯æŒçš„APIåœºæ™¯**

##### ä»ç¤ºä¾‹è¾“å‡ºå¯ä»¥çœ‹å‡ºæ”¯æŒçš„å…¸å‹API:

**ç”µå•†API** (lisek.appç¤ºä¾‹):
```yaml
paths:
  /mobileversion:        # ç‰ˆæœ¬æŸ¥è¯¢API
  /darkstores:          # å•†åº—æ•°æ®API
  /products:            # äº§å“API
  /orders:              # è®¢å•API
  /users/profile:       # ç”¨æˆ·èµ„æ–™API
```

**æµ‹è¯•è¦†ç›–çš„APIç±»å‹**:
```python
# ä»æµ‹è¯•æ–‡ä»¶å¯ä»¥çœ‹å‡ºæ”¯æŒ
- RESTful APIs        # GET, POST, PUT, DELETE
- Form Data APIs      # application/x-www-form-urlencoded  
- JSON APIs           # application/json
- Generic Key APIs    # åŠ¨æ€é”®å€¼å¯¹API
- Parameter APIs      # è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°
```

#### **é€šç”¨åŒ–ç¨‹åº¦åˆ†æ**

##### **é«˜åº¦é€šç”¨çš„ç‰¹æ€§**:

1. **åè®®æ— å…³æ€§**
   - ä¸é™åˆ¶ç‰¹å®šçš„ä¸šåŠ¡åŸŸ
   - æ”¯æŒä»»ä½•HTTP/HTTPS API
   - è‡ªåŠ¨é€‚åº”ä¸åŒçš„æ•°æ®ç»“æ„

2. **å†…å®¹æ ¼å¼è‡ªé€‚åº”**
   ```python
   # è‡ªåŠ¨æ£€æµ‹å’Œè§£æå¤šç§æ ¼å¼
   formats = ["json", "msgpack", "form-data", "text", "binary"]
   ```

3. **å‚æ•°æ¨¡å¼è¯†åˆ«**
   ```python
   # æ™ºèƒ½å‚æ•°å ä½ç¬¦ç”Ÿæˆ
   param_regex = "[0-9]+"  # å¯é…ç½®çš„å‚æ•°è¯†åˆ«æ¨¡å¼
   ```

4. **å¢é‡åˆ†ææ”¯æŒ**
   ```bash
   # æ”¯æŒå¤šæ¬¡è¿è¡Œï¼Œå¢é‡æ·»åŠ æ–°ç«¯ç‚¹
   mitmproxy2swagger -i new_capture.mitm -o existing_schema.yaml -p https://api.example.com
   ```

#### **é“¶è¡ŒAPIçš„ç‰¹æ®Šæ€§**

è™½ç„¶å·¥å…·éå¸¸é€šç”¨ï¼Œä½†**é“¶è¡ŒAPIç¡®å®éœ€è¦ç‰¹æ®Šå¤„ç†**ï¼š

##### é“¶è¡ŒAPIçš„å¤æ‚æ€§
```python
# é“¶è¡Œç‰¹æœ‰çš„å¤æ‚æ€§
bank_specific_challenges = {
    "authentication": "å¤šæ­¥è®¤è¯æµç¨‹",
    "session_management": "å¤æ‚çš„ä¼šè¯ç®¡ç†", 
    "data_extraction": "éæ ‡å‡†æ•°æ®æ ¼å¼",
    "business_logic": "ç‰¹å®šçš„ä¸šåŠ¡è§„åˆ™",
    "security": "ä¸¥æ ¼çš„å®‰å…¨è¦æ±‚"
}
```

##### ä¸ºä»€ä¹ˆéœ€è¦å®šåˆ¶åŒ–
1. **æ•°æ®æ ¼å¼ç‰¹æ®Š** - é“¶è¡Œè¿”å›çš„æ•°æ®æ ¼å¼å¾€å¾€éæ ‡å‡†JSON
2. **ä¸šåŠ¡é€»è¾‘å¤æ‚** - éœ€è¦ç†è§£é“¶è¡Œç‰¹å®šçš„ä¸šåŠ¡æµç¨‹
3. **å®‰å…¨è¦æ±‚é«˜** - éœ€è¦ç‰¹æ®Šçš„ä¼šè¯ç®¡ç†å’Œè®¤è¯å¤„ç†
4. **éªŒè¯è¦æ±‚ä¸¥æ ¼** - éœ€è¦100%å‡†ç¡®çš„æ•°æ®æå–

### æ€»ç»“

**mitmproxy2swaggeræ˜¯ä¸€ä¸ªé«˜åº¦é€šç”¨çš„å·¥å…·**ï¼Œå®ƒèƒ½å¤Ÿï¼š

âœ… **åˆ†æä»»ä½•HTTP API** - ä¸é™ä¸šåŠ¡åŸŸ  
âœ… **æ”¯æŒä¸»æµæ•°æ®æ ¼å¼** - JSON, XML, Form, Binaryç­‰  
âœ… **è‡ªåŠ¨ç”ŸæˆOpenAPIè§„èŒƒ** - ç¬¦åˆè¡Œä¸šæ ‡å‡†  
âœ… **æ™ºèƒ½ç±»å‹æ¨æ–­** - å‡å°‘äººå·¥å¹²é¢„  

ä½†å¯¹äº**é“¶è¡Œç­‰ç‰¹æ®Šé¢†åŸŸ**ï¼Œä»ç„¶éœ€è¦åœ¨é€šç”¨å·¥å…·åŸºç¡€ä¸Šè¿›è¡Œ**ä¸šåŠ¡å®šåˆ¶**ï¼Œè¿™æ­£æ˜¯æ‚¨çš„10å®¶é“¶è¡Œæ–¹æ¡ˆçš„ä»·å€¼æ‰€åœ¨ï¼š

**é€šç”¨å·¥å…· â†’ é¢†åŸŸå®šåˆ¶ â†’ ä¸šåŠ¡ä¼˜åŒ–**

è¿™ç§åˆ†å±‚çš„æ–¹æ³•æ—¢ä¿è¯äº†æŠ€æœ¯çš„é€šç”¨æ€§ï¼Œåˆæ»¡è¶³äº†ä¸šåŠ¡çš„ç‰¹æ®Šæ€§ï¼

## 6. mitmproxy2swaggeræ™ºèƒ½ç±»å‹æ¨æ–­æŠ€æœ¯å†…å¹•å‰–æ

åŸºäºå¯¹ä»£ç çš„æ·±å…¥åˆ†æï¼Œæ­ç§˜è¿™ä¸ªå·¥å…·çš„æ™ºèƒ½ç±»å‹æ¨æ–­æ˜¯å¦‚ä½•å®ç°çš„ï¼š

### **æ ¸å¿ƒæ¨æ–­ç®—æ³•ï¼šé€’å½’ç±»å‹åˆ†æå¼•æ“**

#### `value_to_schema()` - æ ¸å¿ƒç®—æ³•
```python
def value_to_schema(value):
    # ğŸ” åŸºç¡€ç±»å‹æ£€æµ‹ - ä½¿ç”¨Pythonå†…ç½®ç±»å‹æ£€æŸ¥
    if type(value) is int or type(value) is float:
        return {"type": "number"}
    elif isinstance(value, bool):
        return {"type": "boolean"}  
    elif isinstance(value, str):
        return {"type": "string"}
    
    # ğŸ” æ•°ç»„ç±»å‹æ¨æ–­ - åŸºäºé¦–å…ƒç´ æ¨æ–­æ•´ä¸ªæ•°ç»„ç±»å‹
    elif isinstance(value, list):
        if len(value) == 0:
            return {"type": "array", "items": {}}
        return {"type": "array", "items": value_to_schema(value[0])}  # âš¡ é€’å½’ï¼
    
    # ğŸ” å¯¹è±¡ç±»å‹æ™ºèƒ½æ¨æ–­ - æœ€å¤æ‚çš„éƒ¨åˆ†
    elif isinstance(value, dict):
        all_keys_are_numeric = all(is_numeric_string(key) for key in value)
        all_keys_are_uuid = all(is_uuid(key) for key in value)
        keys_are_generic = all_keys_are_numeric or all_keys_are_uuid

        # ğŸ¯ æ™ºèƒ½æ¨¡å¼è¯†åˆ«ï¼šå¦‚æœæ‰€æœ‰é”®éƒ½æ˜¯é€šç”¨æ¨¡å¼
        if keys_are_generic and len(value) > 0:
            return {
                "type": "object",
                "additionalProperties": value_to_schema(list(value.values())[0])  # âš¡ é€’å½’ï¼
            }
        # ğŸ¯ å¸¸è§„å¯¹è±¡ï¼šé€ä¸ªå±æ€§åˆ†æ    
        return {
            "type": "object", 
            "properties": {key: value_to_schema(value[key]) for key in value}  # âš¡ é€’å½’ï¼
        }
```

**ç®—æ³•ç‰¹ç‚¹**:
- âœ… **é€’å½’æ·±åº¦åˆ†æ** - å¯å¤„ç†ä»»æ„æ·±åº¦çš„åµŒå¥—ç»“æ„
- âœ… **é›¶é…ç½®æ¨æ–­** - å®Œå…¨åŸºäºæ•°æ®æœ¬èº«çš„ç‰¹å¾
- âœ… **æ¨¡å¼è¯†åˆ«ä¼˜åŒ–** - è‡ªåŠ¨è¯†åˆ«å¹¶ä¼˜åŒ–é€šç”¨é”®æ¨¡å¼

### **æ™ºèƒ½æ¨¡å¼è¯†åˆ«ç³»ç»Ÿ**

#### é€šç”¨é”®æ¨¡å¼æ£€æµ‹
```python
def is_numeric_string(key):
    return isinstance(key, str) and key.isnumeric()  # "1234", "5678"

def is_uuid(key):
    return isinstance(key, str) and is_valid_uuid(key)  # "123e4567-e89b-12d3-a456-426614174000"

def is_valid_uuid(val):
    try:
        uuid.UUID(str(val))  # ä½¿ç”¨æ ‡å‡†UUIDéªŒè¯
        return True
    except ValueError:
        return False
```

#### å®é™…åº”ç”¨ç¤ºä¾‹
åŸºäºæµ‹è¯•æ•°æ® `generic_keys_testclient.py`ï¼š

```python
# åŸå§‹æ•°æ®
data = {
    "numeric": {
        "1234": {"lorem": "ipsum", "dolor": "sit"},  # ğŸ” æ•°å­—é”®æ¨¡å¼
        "5678": {"lorem": "ipsum", "dolor": "sit"}   # ğŸ” æ•°å­—é”®æ¨¡å¼
    },
    "uuid": {
        "123e4567-e89b-12d3-a456-426614174000": {...},  # ğŸ” UUIDé”®æ¨¡å¼
        "123e4567-e89b-12d3-a456-426614174001": {...}   # ğŸ” UUIDé”®æ¨¡å¼
    },
    "mixed": {
        "1234": {...},                                   # ğŸ” æ··åˆé”®æ¨¡å¼
        "123e4567-e89b-12d3-a456-426614174000": {...}   # ğŸ” æ··åˆé”®æ¨¡å¼
    }
}

# ç”Ÿæˆçš„Schemaï¼ˆæ™ºèƒ½ä¼˜åŒ–åï¼‰
{
    "type": "object",
    "properties": {
        "numeric": {
            "type": "object", 
            "additionalProperties": {  # âš¡ æ™ºèƒ½ä¼˜åŒ–ï¼šä¸å±•å¼€æ‰€æœ‰æ•°å­—é”®
                "type": "object",
                "properties": {
                    "lorem": {"type": "string"},
                    "dolor": {"type": "string"}
                }
            }
        },
        "uuid": {
            "type": "object",
            "additionalProperties": {...}  # âš¡ æ™ºèƒ½ä¼˜åŒ–ï¼šä¸å±•å¼€æ‰€æœ‰UUIDé”®
        },
        "mixed": {
            "type": "object", 
            "properties": {  # âš¡ æ··åˆæ¨¡å¼ï¼šå±•å¼€æ‰€æœ‰é”®
                "1234": {...},
                "123e4567-e89b-12d3-a456-426614174000": {...}
            }
        }
    }
}
```

### **å¤šæ ¼å¼æ•°æ®è§£æå±‚**

#### åˆ†å±‚è§£æç­–ç•¥ 
```python
# ç¬¬1å±‚ï¼šJSONè§£æ
try:
    body_val = json.loads(req.get_request_body())
    content_type = "application/json"
except (UnicodeDecodeError, json.decoder.JSONDecodeError):
    pass

# ç¬¬2å±‚ï¼šMessagePackè§£æ 
if body_val is None:
    try:
        body_val = msgpack.loads(req.get_request_body())
        content_type = "application/msgpack"
    except Exception:
        pass

# ç¬¬3å±‚ï¼šè¡¨å•æ•°æ®è§£æ
if content_type is None:
    try:
        body_val_bytes = dict(urllib.parse.parse_qsl(body, encoding="utf-8"))
        # è½¬æ¢å­—èŠ‚ä¸ºå­—ç¬¦ä¸²...
        content_type = "application/x-www-form-urlencoded"
    except UnicodeDecodeError:
        pass
```

**è§£æç‰¹ç‚¹**:
- âœ… **å®¹é”™æ€§å¼º** - é€å±‚å°è¯•ï¼Œä¸ä¼šå› å•ä¸ªæ ¼å¼å¤±è´¥è€Œåœæ­¢
- âœ… **æ ¼å¼è‡ªé€‚åº”** - è‡ªåŠ¨è¯†åˆ«æ•°æ®æ ¼å¼
- âœ… **ç¼–ç å¤„ç†** - æ­£ç¡®å¤„ç†UTF-8ç­‰ç¼–ç é—®é¢˜

### **å‚æ•°ç±»å‹æ™ºèƒ½æ¨æ–­**

#### URLå‚æ•°æ¨æ–­
```python
def url_to_params(url, path_template):
    # è·¯å¾„å‚æ•°æ¨æ–­
    for idx, segment in enumerate(segments):
        if segment.startswith("{") and segment.endswith("}"):
            params.append({
                "name": segment.replace("{", "").replace("}", ""),
                "in": "path",
                "required": True,
                "schema": {
                    "type": "number" if url_segments[idx].isdigit() else "string"  # âš¡ æ™ºèƒ½æ¨æ–­
                }
            })
    
    # æŸ¥è¯¢å‚æ•°æ¨æ–­        
    query_params = urllib.parse.parse_qs(query_string)
    for key in query_params:
        params.append({
            "name": key,
            "in": "query", 
            "required": False,
            "schema": {
                "type": "number" if query_params[key][0].isdigit() else "string"  # âš¡ æ™ºèƒ½æ¨æ–­
            }
        })
```

### **æ€§èƒ½ä¼˜åŒ–æœºåˆ¶**

#### ç¤ºä¾‹æ•°æ®å¤§å°é™åˆ¶
```python
MAX_EXAMPLE_ARRAY_ELEMENTS = 10      # æ•°ç»„ç¤ºä¾‹æœ€å¤§å…ƒç´ æ•°
MAX_EXAMPLE_OBJECT_PROPERTIES = 150  # å¯¹è±¡ç¤ºä¾‹æœ€å¤§å±æ€§æ•°

def limit_example_size(example):
    if isinstance(example, list):
        new_list = []
        for element in example:
            if len(new_list) >= MAX_EXAMPLE_ARRAY_ELEMENTS:
                break  # âš¡ é˜²æ­¢ç¤ºä¾‹æ•°æ®è¿‡å¤§
            new_list.append(limit_example_size(element))
        return new_list
    # ... ç±»ä¼¼çš„å¯¹è±¡å¤„ç†
```

### **æŠ€æœ¯å®ç°äº®ç‚¹**

#### 1. **é›¶é…ç½®æ™ºèƒ½åŒ–**
- âŒ **ä¸éœ€è¦é¢„å®šä¹‰Schema**
- âŒ **ä¸éœ€è¦é…ç½®æ–‡ä»¶**  
- âœ… **å®Œå…¨åŸºäºæ•°æ®æœ¬èº«æ¨æ–­**

#### 2. **å¯å‘å¼ä¼˜åŒ–**
```python
# é“¶è¡Œæ•°æ®è¿™æ ·çš„åœºæ™¯:
bank_data = {
    "accounts": {
        "12345678": {"balance": "1000.00", "currency": "HKD"},
        "87654321": {"balance": "500.00", "currency": "USD"}
    }
}

# è‡ªåŠ¨è¯†åˆ«ä¸ºæ•°å­—é”®æ¨¡å¼ï¼Œç”Ÿæˆä¼˜åŒ–çš„Schema:
{
    "type": "object",
    "properties": {
        "accounts": {
            "type": "object",
            "additionalProperties": {  # âš¡ è€Œä¸æ˜¯å±•å¼€æ¯ä¸ªè´¦å·
                "type": "object", 
                "properties": {
                    "balance": {"type": "string"},
                    "currency": {"type": "string"}
                }
            }
        }
    }
}
```

#### 3. **é€’å½’æ·±åº¦æ— é™åˆ¶**
èƒ½å¤Ÿå¤„ç†ä»»æ„æ·±åº¦çš„åµŒå¥—æ•°æ®ç»“æ„ï¼Œè¿™å¯¹å¤æ‚çš„APIå“åº”ï¼ˆå¦‚é“¶è¡Œçš„å¤šå±‚åµŒå¥—æ•°æ®ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚

### **ä¸é“¶è¡ŒAPIåˆ†æçš„å…³è”**

å¯¹äºæ‚¨çš„é“¶è¡ŒProvideré¡¹ç›®ï¼Œè¿™ä¸ªæ™ºèƒ½æ¨æ–­èƒ½åŠ›ç‰¹åˆ«æœ‰ä»·å€¼ï¼š

```python
# æ‹›å•†æ°¸éš†é“¶è¡Œçš„å¤æ‚å“åº”æ•°æ®
bank_response = {
    "accounts": {
        "CON_12345": {
            "balances": {
                "HKD": ["7,150.98"],
                "USD": ["30.75"], 
                "CNY": ["0.00"]
            }
        }
    }
}

# å·¥å…·ä¼šè‡ªåŠ¨æ¨æ–­ä¸º:
{
    "type": "object",
    "properties": {
        "accounts": {
            "type": "object",
            "additionalProperties": {  # âš¡ æ™ºèƒ½è¯†åˆ«è´¦æˆ·æ¨¡å¼
                "type": "object",
                "properties": {
                    "balances": {
                        "type": "object",
                        "properties": {
                            "HKD": {"type": "array", "items": {"type": "string"}},
                            "USD": {"type": "array", "items": {"type": "string"}},
                            "CNY": {"type": "array", "items": {"type": "string"}}
                        }
                    }
                }
            }
        }
    }
}
```

### æ€»ç»“

mitmproxy2swaggerçš„æ™ºèƒ½ç±»å‹æ¨æ–­**ä¸ä¾èµ–ä»»ä½•æœºå™¨å­¦ä¹ æˆ–AI**ï¼Œè€Œæ˜¯åŸºäºï¼š

1. **é€’å½’ç®—æ³•** - æ·±åº¦éå†æ•°æ®ç»“æ„
2. **æ¨¡å¼è¯†åˆ«** - å¯å‘å¼è§„åˆ™æ£€æµ‹é€šç”¨æ¨¡å¼  
3. **ç±»å‹æ¨æ–­** - åŸºäºPythonå†…ç½®ç±»å‹ç³»ç»Ÿ
4. **æ ¼å¼è‡ªé€‚åº”** - å¤šå±‚è§£æç­–ç•¥
5. **æ€§èƒ½ä¼˜åŒ–** - æ™ºèƒ½é™åˆ¶å’Œç¼“å­˜

è¿™ç§**ç¡®å®šæ€§ç®—æ³•**çš„ä¼˜åŠ¿æ˜¯**å¯é¢„æµ‹ã€å¯è°ƒè¯•ã€æ— ä¾èµ–**ï¼Œéå¸¸é€‚åˆä¼ä¸šçº§åº”ç”¨åœºæ™¯ï¼